function RegularExpression(a,c,b,e){var g="",f=[];this.getName=function(){return a};this.getFlags=function(){return c};this.getUrls=function(){return b};this.setRegularExpression=function(a){g=a;return this};this.setFlags=function(a){f=a;return this};this.getSetFlags=function(){return f};this.getRegularExpression=function(){return g};this.parse=function(b,d){var c=RegularExpressionCache.getValue(b,g,f,a);if("boolean"!=typeof c)return d(c),this;new e(this,b,g,f,function(a){a&&"undefined"!=typeof a.error&&
(RegularExpressionCache.addValue(a),d(a))});return this}};function ParserJavascript(a,c,b,e,g){var a="",f=!1,h,d,i,k,m=[];try{h=0;for(d=e.length;h<d;h++)switch(e[h]){case "g":a+="g";f=!0;break;case "m":a+="m";break;case "i":a+="i"}for(i=RegExp(b,a);null!=(k=i.exec(c))&&!(m[m.length]={text:k[0],index:k.index,subexpressions:k},!f||""==k[0]););g({parser:"javascript",regularExpression:b,flags:e,matchText:c,error:!1,matchings:m,programming:"var text = '"+c.replace(/\\/g,"\\\\").replace(/'/g,"\\'")+"';\nvar match;\n\nwhile ((match = text.match(/"+b+"/"+a+"))) {\n  console.log(match[0], match);\n}\n"})}catch(q){g({parser:"javascript",
regularExpression:b,flags:e,matchText:c,error:q.message,matchings:[],progamming:""})}};function ParserAjax(a,c,b,e,g){$.post("parser/parser.php",{json:$.toJSON({parser:a.getName(),regularExpression:b,flags:e,matchText:c})},g,"json")};function Help(){$("<div>press escape to exit tour</div>").attr("id","darkRoom").appendTo("body");var a=[new SetMessageStep('Welcome to the <span class="appname">regex<strong>pad</strong></span> tour'),new WaitStep(5E3),new SetMessageStep("Select the language you want to use"),new MoveMessageStep("#parser-type",4),new HighlightStep("#parser-type"),new Step(function(){$("#parser-type").focus().fadeOut(500).fadeIn(500).fadeOut(500).fadeIn(500).fadeOut(500).fadeIn(500)},7500),new LowlightStep("#parser-type"),
new SetMessageStep("Write an example text to be matched by your regular expression"),new HighlightStep(".matchtext-block:nth-child(1)"),new MoveMessageStep("#matchtext",4,1500),new WaitStep(2E3),new Step(function(){new TypeInto($("#matchtext").focus(),"abb",500)},7E3),new WaitStep(1E3),new LowlightStep(".matchtext-block:nth-child(1)"),new SetMessageStep("Add another example area to match a different text"),new HighlightStep("#add-matchtext"),new MoveMessageStep("#add-matchtext",4,3E3),new Step(function(){$("#add-matchtext").focus().fadeOut(500).fadeIn(500).fadeOut(500).fadeIn(500).fadeOut(500).fadeIn(500,
function(){$("#add-matchtext").click()})},4500),new LowlightStep("#add-matchtext"),new SetMessageStep("Now you can fill in another example to be matched"),new MoveMessageStep(".matchtext-block:nth-child(2)",4,2E3),new HighlightStep(".matchtext-block:nth-child(2)"),new Step(function(){new TypeInto($("#newid"+(matchingBlockId-1)).focus(),"test abc ade",300)},1E4),new LowlightStep(".matchtext-block:nth-child(2)"),new SetMessageStep("Here you can enter your regular expression"),new HighlightStep("#regex"),
new MoveMessageStep("#regex",3),new Step(function(){$("#regex").focus();new TypeInto($("#regex"),"a([a-z]+)",300)},1E4),new LowlightStep("#regex"),new HighlightStep(".matchtext-block"),new SetMessageStep("Look at your sample text: the green background highlights the matched text"),new WaitStep(1E4),new SetMessageStep("Now it's your turn, give it a try!"),new MoveMessageStep("header",3,2E3),new WaitStep(4E3),new Step(function(){location.reload()},100)],c=function(b){"undefined"!=typeof a[b]&&(a[b].run(),
setTimeout(function(){c(b+1)},a[b].time))};$(document).keyup(function(a){27==a.keyCode&&location.reload()});$(".remove-matchtext").click();$("#help-current-task").html("").show();c(0)};function HighlightStep(a){this.run=function(){$(a).css({position:"relative","z-index":"999"})};this.time=100};function LowlightStep(a){this.run=function(){$(a).css("z-index",1)};this.time=100};function MoveMessageStep(a,c,b){var e=$("#help-current-task");"undefined"==typeof b&&(b=1E3);this.run=function(){var g=$(a),f=g.offset(),h=f.left,f=f.top;switch(c){case 1:f-=e.height()+20;break;case 2:h+=g.width()+50;break;case 3:f+=g.height()+20;break;case 4:h-=e.width()+50}e.animate({left:Math.round(h),top:Math.round(f)},Math.round(0.9*b))};this.time=b};function SetMessageStep(a){this.run=function(){$("#help-current-task").html(a)};this.time=100};function Step(a,c){this.run=a;this.time=c};function WaitStep(a){this.run=function(){};this.time=a};function TypeInto(a,c,b){var e=0,g=function(){a.val(c.substring(0,e));a.trigger("keyup");e<c.length&&(e++,setTimeout(g,b))};g()};function Flag(a,c,b){var e;"undefined"==typeof b&&(b=a);e=$('<li><label for="option-'+a+'"><input type="checkbox" name="option-'+a+'" id="option-'+a+'" class="parser-option"><strong>'+b+"</strong>"+c+"</label></li>");this.getLi=function(){return e}};function UIMatchText(a,c){var b=this,e=a.find(".textarea"),g=a.find(".matchtext-div"),f=a.find(".match-info"),h=a.find(".next-match"),d=a.find(".previous-match"),i=a.find(".match-more-info"),k=a.find(".more-information"),m=k.find(".more-information-content");i.hide();k.hide();var q=RegHex.addMatchText(this,e.val());e.bind("change keyup paste cut",function(){q.notify()});e.scroll(function(){b.updateScrollPosition()});var j=null,l=0,n=!1,p=function(a){a=s(a,"<","&lt;");a=s(a,">","&gt;");return a=s(a,
"\n","<br>")},s=function(a,d,b){for(;-1!=a.indexOf(d);)a=a.replace(d,b);return a};this.notify=function(a){e.val()==a.matchText&&j!=a&&(j=a,l=0,this.update());return this};this.highlight=function(){if(!j||j.error)g.html("");else{var a=j.matchText,d="";if(0==j.matchings.length)d='<span class="unmatched">'+p(a)+"</span>";else{var b=j.matchings[l].text.length,c=j.matchings[l].index;0>=b?d='<span class="unmatched">'+p(a)+"</span>":(0!=c&&(d+='<span class="unmatched">'+p(a.substring(0,c))+"</span>"),d+=
'<span class="matched">'+p(a.substring(c,c+b))+"</span>",a.length!=c+b&&(d+='<span class="unmatched">'+p(a.substring(c+b))+"</span>"))}0!=a.length&&"\n"==a.substring(a.length-1)&&(d+="<span>&nbsp;</span>");g.html(d)}return this};this.getText=function(){return e.val()};this.setText=function(a){e.val(a).change();return this};this.updateInfobox=function(){n||k.slideUp();if(!j||j.error||0==j.matchings.length)f.html("no matches"),h.attr("disabled","disabled"),d.attr("disabled","disabled"),i.slideUp(),
k.slideUp();else{f.html("match "+(l+1)+" of "+j.matchings.length);var a=j.matchings[l].subexpressions;if(!a||0>=a.length)m.html("no subexpressions given.");else{for(var b="subexpressions <small>(expression parts in brackets)</small>:<ul>",c=0;c<a.length;c++)b+="<li>"+$("<li/>").text("$"+c+" = "+a[c]).html()+"</li>";m.html(b+"</ul>")}0==l||j.error?d.attr("disabled","disabled"):d.removeAttr("disabled");l>=j.matchings.length-1||j.error?h.attr("disabled","disabled"):h.removeAttr("disabled");n?k.slideDown():
i.slideDown()}};this.update=function(){this.highlight();this.updateInfobox();this.updateScrollPosition();return this};this.updateScrollPosition=function(){g.scrollTop(e.scrollTop());g.scrollLeft(e.scrollLeft());return this};this.nextMatch=function(){j&&l<j.matchings.length-1&&l++;this.update();return this};this.previousMatch=function(){0<l&&l--;this.update();return this};this.moreInformation=function(a){void 0==a&&(a=!n);n!=a&&(n=a,this.update());return this};h.click(function(){b.nextMatch()});d.click(function(){b.previousMatch()});
i.find("a").click(function(){b.moreInformation();return!1});k.find(".less-information").click(function(){b.moreInformation(!1);return!1});this.update();if(c){var r=$('<button type="button" class="remove-matchtext"/>');r.html("&ndash;");r.attr("title","remove field");r.click(function(){a.slideUp(function(){RegHex.removeMatchText(q);$(this).remove()})});a.find(".navigate-match-section").prepend("&nbsp;").prepend(r);a.hide();$("#matching-blocks").append(a);a.show()}};function MatchText(a){var c="",b=function(){};this.setResponseCallback=function(a){b=a};this.setText=function(a){c=a;return this};this.getText=function(){return c};this.notify=function(e,g,f){var h;"undefined"==typeof e&&(e=a);"undefined"==typeof g&&(g=function(){});h="undefined"==typeof f?b:function(a){b(a);f(a)};this.setText(e.getText());RegHex.getRegularExpression().parse(c,function(a){"boolean"!=typeof a.error&&g(a.error);e.notify(a);h(a)});return this}};function UIMessageService(){var a=$("#regex-error");this.notify=function(c){"undefined"==typeof c?a.slideUp():a.text(c).slideDown()}};function UICodeSnip(){var a=$("#codeblock");this.update=function(c){a.val(c).show()}};var Permalink=function(a){var c=this;this.update=function(){var b,c,g=RegHex.getRegularExpression(),f=g.getSetFlags();b=g.getRegularExpression();var h=RegHex.getMatchTexts(),d="?r="+encodeURIComponent(b)+"&f=";b=0;for(c=f.length;b<c;b++)d+=encodeURI(f[b]),b+1<c&&(d+=encodeURIComponent(","));b=0;for(c=h.length;b<c;b++)d+="&m"+b+"="+encodeURIComponent(h[b].getText());d+="#p-"+g.getName();a.attr("href",d)};RegHex.registerChangeHandler(function(){c.update()})};var config={parsers:[new RegularExpression("javascript",[new Flag("g","global search"),new Flag("i","ignore case"),new Flag("m","multiple lines")],[["https://developer.mozilla.org/en/JavaScript/Reference/Global_Objects/RegExp","Mozilla Javascript Reference"]],ParserJavascript),new RegularExpression("sun-java",[new Flag("d","unix lines"),new Flag("i","ignore case"),new Flag("m","multiple lines"),new Flag("s","dotall mode"),new Flag("u","unicode-aware case folding"),new Flag("x","permits whitespace and comments")],
[["http://docs.oracle.com/javase/1.4.2/docs/api/java/util/regex/Pattern.html","Oracle Java Reference"]],ParserAjax),new RegularExpression("php",[new Flag("g","global search"),new Flag("i","ignore case"),new Flag("m","multiple lines"),new Flag("s","dotall mode"),new Flag("u","unicode-aware case folding"),new Flag("x","permits whitespace and comments")],[["http://www.php.net/manual/en/reference.pcre.pattern.modifiers.php","PHP Reference"],["http://www.regular-expressions.info/php.html","Usage information"]],
ParserAjax),new RegularExpression("gnu-grep",[new Flag("E","extended regexp (egrep)"),new Flag("F","fixed strings (fgrep)"),new Flag("i","ignore case"),new Flag("v","invert match"),new Flag("w","word regexp"),new Flag("x","line regexp")],[["http://en.wikipedia.org/wiki/Grep","Wikipedia"],["http://www.regular-expressions.info/gnu.html","Usage information"],["http://pubs.opengroup.org/onlinepubs/9699919799/utilities/grep.html","Commands & Utilities Reference"]],ParserAjax),new RegularExpression("apache-rewriterule",
[new Flag("i","ignore case","[NC]"),new Flag("N","not operator","!")],[],ParserAjax)]};var RegularExpressionCache=new function(){var a={},c=0,b=null,e=null,g=function(a){"undefined"==typeof a&&(a=[]);a.sort();for(var b="",d=0;d<a.length;d++)b+=a[d];return b};this.getValue=function(b,c,d,i){if(!("undefined"==typeof a[i]||"undefined"==typeof a[i][c]))for(var d=g(d),k=0;k<a[i][c].length;k++){var e=a[i][c][k];if(e.matchText==b&&e.flagsHash==d)return e}return!1};this.addValue=function(f){var h=f.parser,d=f.regularExpression;if(!("undefined"==typeof h||"undefined"==typeof d)){f.flagsHash=
g(f.flags);"undefined"==typeof a[h]&&(a[h]={});"undefined"==typeof a[h][d]&&(a[h][d]=[]);null==b?b=f:e._next=f;e=f;a[h][d][a[h][d].length]=f;for(c++;100<c;){for(var f=b,h=f.parser,d=f.regularExpression,i=0;i<a[h][d].length;i++)if(a[h][d][i]==f){a[h][d].splice(i,1);break}0==a[h][d].length&&delete a[h][d];b=f._next;c--}}}};var RegHex=new function(){var a,c=[],b=[],e={notify:function(){}},g={update:function(){}},f=function(){for(var a=!1,b=0;b<c.length;b++)c[b].notify(c[b].observer,function(b){e.notify(b);a=!0});a||e.notify()},h=function(a){var c;"undefined"!=typeof a.programming&&g.update(a.programming);a=0;for(c=b.length;a<c;a++)b[a].call()};this.addMatchText=function(a,b){var e=new MatchText(a);e.setText(b);e.setResponseCallback(h);c.push(e);return e};this.getMatchTexts=function(){return c};this.removeMatchText=function(a){for(var b=
0;b<c.length;b++)if(c[b]==a){c.splice(b,1);break}return this};this.registerMessageService=function(a){e=a};this.registerCodeSnip=function(a){g=a};this.updateRegularExpression=function(b,c){a.setRegularExpression(b);a.setFlags(c);f()};this.getRegularExpression=function(){return a};this.changeParserType=function(b){for(var c=0;c<config.parsers.length;c++)config.parsers[c].getName()==b&&(a=config.parsers[c]);f()};this.registerChangeHandler=function(a){b.push(a)}};var matchingBlockId=1,lastInsertedMatchText=null;
$(function(){var a,c;$("textarea").val("");$(".matchtext-block").each(function(){lastInsertedMatchText=new UIMatchText($(this),!1)});RegHex.registerMessageService(new UIMessageService);var b=new UICodeSnip;RegHex.registerCodeSnip(b);var e=function(){var a=[];$(".parser-option").each(function(b,c){$(c).is(":checked")&&a.push($(c).attr("name").substr(7))});return a};$("#regex").bind("keyup blur input cut paste",function(){RegHex.updateRegularExpression($(this).val(),e())});$("#add-matchtext").click(function(){var a=
matchingBlockId++,b=$("#matching-blocks").find(".matchtext-block").first().clone();b.find("label").html("&nbsp;").attr("for","newid"+a);b.find(".textarea").text("").attr("id","newid"+a);b.find(".matchtext-div").html("&nbsp;");lastInsertedMatchText=new UIMatchText(b,!0)});var g=$("#parser-type");a=0;for(c=config.parsers.length;a<c;a++)g.append($('<option value="'+config.parsers[a].getName()+'">'+config.parsers[a].getName()+"</option>"));g.change(function(){var a,c;RegHex.changeParserType($("#parser-type").val());
$(".current-parser-name").text($("#parser-type").val());$("#regex-options").html("");var d=RegHex.getRegularExpression().getFlags();a=0;for(c=d.length;a<c;a++)$("#regex-options").append(d[a].getLi());$('#regex-options input[type="checkbox"]').change(function(){$("#regex").trigger("keyup")});var d=RegHex.getRegularExpression().getUrls(),e="";a=0;for(c=d.length;a<c;a++)e+='<li><a href="'+d[a][0]+'">'+d[a][1]+"</a></li>";""!=e?$("#additional-parser-info").html("<ul>"+e+"</ul>"):$("#additional-parser-info").html(e);
b.update("");$("#regex").keyup();window.location.hash="#p-"+$("#parser-type").val()});$("#button-tour").click(function(){new Help;return!1});new Permalink($("#button-permalink"));var f;(f=window.location.hash.match(/^#p-(.+)$/))&&g.find("option").each(function(){var a=$(this);a.val()==f[1]?a.attr("selected",!0):a.removeAttr("selected")});g.change();var g=window.location.search.substring(1).split("&"),h=!0;a=0;for(c=g.length;a<c;a++){var d=g[a].split("=");if(2==d.length&&""!=d[1])if("f"==d[0])for(var d=
d[1].split(","),i=0;i<d.length;i++)$("#option-"+decodeURIComponent(d[i])).attr("checked",!0);else if("r"==d[0])$("#regex").val(decodeURIComponent(d[1]));else if(f=d[0].match(/^m(\d)$/))h?h=!1:$("#add-matchtext").click(),lastInsertedMatchText.setText(decodeURIComponent(d[1]))}$("#regex").trigger("keyup")});
